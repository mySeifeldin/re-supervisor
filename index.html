<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIP | Artificial Intelligence Property Supervisor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; }
        .glass-card { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .sidebar-item { transition: all 0.2s; border-radius: 12px; margin: 4px 0; border: none; background: transparent; cursor: pointer; text-align: left; color: #94a3b8; width: 100%; padding: 12px; display: flex; align-items: center; gap: 12px; }
        .sidebar-item:hover, .sidebar-item.active { background: #3b82f6; color: white; }
        .chart-container { position: relative; height: 250px; width: 100%; }
        /* Logo styling to ensure it fits perfectly */
        .brand-logo { width: 140px; height: auto; filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.5)); }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 glass-card h-full p-6 flex flex-col border-r border-gray-800">
        <div class="mb-10 px-2 flex flex-col items-center border-b border-gray-800 pb-6">
            <img src="https://github.com/mySeifeldin/re-supervisor/blob/main/logo.png" alt="AIP Logo" class="brand-logo mb-3">
            <div class="text-center">
                <h1 class="text-sm font-bold tracking-widest text-white uppercase">AI Property</h1>
                <p class="text-[10px] text-blue-500 font-bold uppercase tracking-tighter">Supervisor Command Hub</p>
            </div>
        </div>

        <nav class="flex-1">
            <button onclick="showTab('dashboard', event)" class="sidebar-item active"><i class="fas fa-chart-line"></i> Analytics</button>
            <button onclick="showTab('projects', event)" class="sidebar-item"><i class="fas fa-city"></i> Projects</button>
            <button onclick="showTab('units', event)" class="sidebar-item"><i class="fas fa-key"></i> Units</button>
            <button onclick="showTab('brokers', event)" class="sidebar-item"><i class="fas fa-user-shield"></i> Brokers</button>
            <button onclick="showTab('clients', event)" class="sidebar-item"><i class="fas fa-handshake"></i> Deals</button>
        </nav>

        <div class="mt-auto pt-6 border-t border-gray-800 text-[9px] text-gray-500 text-center">
            Â© 2026 Artificial Intelligence Property (AIP)
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-10 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-blue-900/10 via-slate-950 to-slate-950">
        
        <section id="tab-dashboard">
            <div class="flex items-center gap-4 mb-8">
                <img src="https://myseifeldin.github.io/re-supervisor/logo.png" class="w-10 h-auto opacity-50">
                <h2 class="text-3xl font-black">AIP <span class="text-blue-500">Analytics</span></h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
                <div class="glass-card p-6 rounded-2xl border-l-4 border-blue-500">
                    <p class="text-gray-400 text-xs font-bold uppercase">Portfolio Projects</p>
                    <h2 id="count-projects" class="text-4xl font-black">--</h2>
                </div>
                <div class="glass-card p-6 rounded-2xl border-l-4 border-green-500">
                    <p class="text-gray-400 text-xs font-bold uppercase">AIP Available Inventory</p>
                    <h2 id="count-units" class="text-4xl font-black text-green-400">--</h2>
                </div>
                <div class="glass-card p-6 rounded-2xl border-l-4 border-purple-500">
                    <p class="text-gray-400 text-xs font-bold uppercase">Total Open Deals</p>
                    <h2 id="count-deals" class="text-4xl font-black text-purple-400">--</h2>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="glass-card p-6 rounded-3xl">
                    <h3 class="font-bold mb-4 text-gray-300 italic">Inventory Health</h3>
                    <div class="chart-container"><canvas id="inventoryChart"></canvas></div>
                </div>
                <div class="glass-card p-6 rounded-3xl">
                    <h3 class="font-bold mb-4 text-gray-300 italic">Broker Conversion Performance</h3>
                    <div class="chart-container"><canvas id="brokerChart"></canvas></div>
                </div>
            </div>
        </section>

        <section id="tab-projects" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">AIP Projects List</h2>
                <label class="bg-blue-600 px-4 py-2 rounded-lg cursor-pointer text-sm font-bold transition hover:bg-blue-700">
                    Import Projects <input type="file" class="hidden" onchange="handleFileUpload(event, 'Projects')">
                </label>
            </div>
            <div class="glass-card rounded-xl overflow-x-auto"><table class="w-full text-left text-sm"><thead id="head-projects" class="bg-white/5"></thead><tbody id="rows-projects"></tbody></table></div>
        </section>

        <section id="tab-units" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Units Inventory</h2>
                <label class="bg-green-600 px-4 py-2 rounded-lg cursor-pointer text-sm font-bold transition hover:bg-green-700">
                    Import Units CSV <input type="file" class="hidden" onchange="handleFileUpload(event, 'Units')">
                </label>
            </div>
            <div class="glass-card rounded-xl overflow-x-auto"><table class="w-full text-left text-sm"><thead id="head-units" class="bg-white/5"></thead><tbody id="rows-units"></tbody></table></div>
        </section>

        <section id="tab-brokers" class="hidden">
            <h2 class="text-2xl font-bold mb-6">Assigned AIP Brokers</h2>
            <div class="glass-card rounded-xl overflow-x-auto"><table class="w-full text-left text-sm"><thead id="head-brokers" class="bg-white/5"></thead><tbody id="rows-brokers"></tbody></table></div>
        </section>

       <section id="tab-clients" class="hidden">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Deals & Live AI Guidance</h2>
        <label class="bg-purple-600 px-4 py-2 rounded-lg cursor-pointer text-sm font-bold transition hover:bg-purple-700">
            Import Deals CSV <input type="file" class="hidden" onchange="handleFileUpload(event, 'Clients')">
        </label>
    </div>
    <div class="glass-card rounded-xl overflow-x-auto">
        <table class="w-full text-left text-sm">
            <thead id="head-clients" class="bg-white/5"></thead>
            <tbody id="rows-clients"></tbody>
        </table>
    </div>
</section>

    </main>

    <script>
    // ðŸ”— ØªØ£ÙƒØ¯ Ø¥Ù† Ø¯Ù‡ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙŠ Ø·Ø§Ù„Ø¹ Ù…Ù† Ø§Ù„Ù€ New Deployment
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbze801vGgEPNFFmiFs2Cc7LMwSwpy8791wztuVytL0LGnQHQdN7RWORYQ7Z6mJ59H3ytw/exec";
    let masterData = {};
    let charts = {};

    function showTab(tabName, event) {
        document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.remove('hidden');
        if(event) event.currentTarget.classList.add('active');
        if(tabName !== 'dashboard') renderFullTable(tabName);
    }

    window.handleData = function(data) {
        masterData = data;
        document.getElementById('count-projects').innerText = data.projectsCount || 0;
        document.getElementById('count-units').innerText = data.availableUnits || 0;
        document.getElementById('count-deals').innerText = data.openDeals || 0;
        updateCharts();
    };

    function renderFullTable(type) {
        const data = masterData[type + 'List'];
        const head = document.getElementById('head-' + type);
        const body = document.getElementById('rows-' + type);
        if(!data || data.length === 0) return;

        head.innerHTML = `<tr>${data[0].map(h => `<th class="p-4 font-bold text-blue-400 border-b border-gray-800">${h}</th>`).join('')}</tr>`;
        body.innerHTML = data.slice(1).map(row => `<tr class="border-b border-white/5 hover:bg-white/5 text-xs">${row.map(cell => `<td class="p-4 text-gray-400">${cell}</td>`).join('')}</tr>`).join('');
    }

    function updateCharts() {
        const ctxInv = document.getElementById('inventoryChart').getContext('2d');
        if(charts.inv) charts.inv.destroy();
        charts.inv = new Chart(ctxInv, {
            type: 'doughnut',
            data: {
                labels: ['Available', 'Sold', 'Reserved'],
                datasets: [{
                    data: [masterData.availableUnits || 0, (masterData.unitsList ? masterData.unitsList.length : 0), 0],
                    backgroundColor: ['#3b82f6', '#1e293b', '#60a5fa'],
                    borderWidth: 0
                }]
            },
            options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: '#94a3b8', font: { size: 10 } } } } }
        });
    }

    // ðŸš€ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù„Ù„Ø±ÙØ¹ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
    function handleFileUpload(event, sheetName) {
        const file = event.target.files[0];
        const reader = new FileReader();
        
        reader.onload = async function(e) {
            const text = e.target.result;
            // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£Ø³Ø·Ø± Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„ÙÙˆØ§ØµÙ„ Ø¯Ø§Ø®Ù„ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†ØµÙŠØµ (Regex)
            const rows = text.split(/\r?\n/).map(row => {
                return row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(cell => cell.replace(/^"|"$/g, ''));
            });

            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø¶ÙŠØ©
            const cleanData = rows.filter(r => r.length > 1);

            console.log("ðŸ“¤ Uploading " + cleanData.length + " rows to " + sheetName);

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù€ Apps Script Ø§Ù„Ø¬Ø¯ÙŠØ¯
                const response = await fetch(APPS_SCRIPT_URL, { 
                    method: "POST", 
                    mode: "no-cors", // Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù€ Apps Script
                    body: JSON.stringify({sheet: sheetName, data: cleanData}) 
                });
                
                alert("AIP System: CSV Uploaded for " + sheetName + ". Please refresh in 5 seconds.");
            } catch (err) {
                alert("Upload Failed. Check Console.");
                console.error(err);
            }
        };
        reader.readAsText(file);
    }

    function init() {
        const script = document.createElement('script');
        script.src = `${APPS_SCRIPT_URL}?callback=handleData`;
        document.head.appendChild(script);
    }
    window.onload = init;
</script>
</body>
</html>



